---
marp: true
theme: default
paginate: true
math: katex
---

<style>
section {
  font-family: "Microsoft YaHei", "PingFang SC", "Source Han Sans", "Noto Sans CJK SC", sans-serif;
}
</style>

## <!-- fit -->📘 第2讲：线性回归

---

## 一. 什么是线性回归
### 🔍 1. 从一个实际问题出发

> 假设你是一名数据分析师，正在为一家房地产公司工作。老板让你预测新建住宅的售价。你手上有一些历史数据：

![bg right:35% 80%](https://s.ar8.top/img/picgo/20250423171045665.webp)

老板问你：

>“我们正在建设一个 100 平方米的新房，你能告诉我大概能卖多少钱吗？”

---

### 💡 2. 什么是线性回归（Linear Regression）

线性回归就是用来解决上面这类问题的：

> 🔑 **目标**：  
> 找到一个“最合适的直线”，去拟合一组数据点，从而可以预测新的数据。

这条线的数学形式叫做“线性回归方程”：

$$
\hat{y} = wx + b
$$

其中：

- $\hat{y}$：预测的输出值（如房价）
- $x$：输入变量（如面积）
- $w$：斜率，表示输入每增加 1 单位，输出增加多少
- $b$：截距，表示当 $x = 0$ 时 $y$ 的起始值

---

### 📉 3. 图示理解

- 横轴是面积 $x$，纵轴是房价 $y$
- 每个点表示一个实际房屋销售数据
- 我们要找一条红色的“预测线”，让它尽可能接近所有点

> ✨ 这条线不是“穿过所有点”，而是“最符合所有点的趋势”  
> 📌 换句话说：它是 **误差最小的那条线**

![bg right:40% 100%](https://s.ar8.top/img/picgo/20250423165653565.webp)

---

### 🧠 4. 回归的意思是什么？

“回归”并不表示“回去”，而是统计学上的一个术语，表示：

> 根据已有数据，**预测一个连续变量的值**

常见“回归”问题包括：

- 房价预测（面积 → 价格）
- 薪资预测（年资、学历 → 工资）
- 温度预测（时间、湿度 → 明天温度）

---

## 二. 一元线性回归

你有以下数据：

| 面积（㎡） | 售价（万元） |
|------------|--------------|
| 50         | 200          |
| 60         | 240          |
| 70         | 280          |
| 80         | 320          |
| 90         | 360          |

你希望找到一条线，用面积 $x$ 来预测房价 $y$。

---

### 🧮 1. 模型假设

我们假设房价和面积呈线性关系：

$$
\hat{y} = wx + b
$$


---

### 📉 2. “拟合最好”？

我们不能让这条线随便画，要找一个“最合适”的直线 —— **误差最小**。

- 对于每个样本 $i$，模型的预测值是 $\hat{y}_i = wx_i + b$
- 实际值是 $y_i$
- 所以预测误差是：$y_i - (wx_i + b)$

我们定义总误差（损失函数）为：

$$
L(w, b) = \sum_{i=1}^{n} (y_i - (wx_i + b))^2
$$

![bg right:35% 100%](https://s.ar8.top/img/picgo/20250423172345134.webp)

---

> 📌 为什么平方？因为：
> - 正负误差不会抵消
> - 数学上可导（后面可以求解最优值）

---
### ✏️ 3. 使用偏导求解最优 $w$, $b$

#### 对损失函数求导

$$
L(w, b) = \sum_{i=1}^{n} (y_i - wx_i - b)^2
$$

对 $w$ 和 $b$ 求偏导，并令导数为 0（极小值点）：

---

##### Step 1：对 b 求偏导数（固定 w）

$$
L = \sum (y_i - wx_i - b)^2
$$
$$
\frac{\partial L}{\partial b} = \sum 2(y_i - wx_i - b)(-1)
$$
$$
= -2 \sum (y_i - wx_i - b) = 0
$$
$$
\Rightarrow \sum y_i - w \sum x_i - nb = 0
$$
$$
\Rightarrow b = \frac{1}{n} \sum y_i - w \cdot \frac{1}{n} \sum x_i = \bar{y} - w \bar{x}
$$

---

##### Step 2：对 w 求偏导数

$$
\frac{\partial L}{\partial w} = \sum 2(y_i - wx_i - b)(-x_i)
$$
$$
= -2 \sum x_i (y_i - wx_i - b) = 0
$$

代入前一步求得的 $b = \bar{y} - w\bar{x}$，整理得：

$$
w = \frac{ \sum (x_i - \bar{x})(y_i - \bar{y}) }{ \sum (x_i - \bar{x})^2 }
$$

这就是我们在回归课本中常见的**斜率公式**。

---

## 🧠 几何解释：拟合一条残差平方最小的直线

你可以想象每个点和回归线之间有一条“残差线”（误差线），线性回归选择的那条线，是让**所有这些线段的平方和最小**的那一条。


---

#### 解出 $w$ 与 $b$

最终得到：

$$
w = \frac{\sum (x_i - \bar{x})(y_i - \bar{y})}{\sum (x_i - \bar{x})^2}
$$

$$
b = \bar{y} - w \bar{x}
$$

其中：

- $\bar{x} = \frac{1}{n} \sum x_i$：样本均值  
- $\bar{y} = \frac{1}{n} \sum y_i$：输出均值

> ✅ 这就是最优“拟合线”的解析解

---

## 🎯 三. 二元线性回归

老板现在告诉你，不光是**房屋面积**影响房价，**楼层**也有很大关系。

于是我们有以下数据（每个样本两个输入）：

| 面积（㎡） $x_1$ | 楼层 $x_2$ | 售价 $y$（万元） |
|-------------------|-------------|-------------------|
| 50                | 1           | 200               |
| 60                | 2           | 250               |
| 70                | 3           | 300               |
| 80                | 4           | 350               |
| 90                | 5           | 400               |

---

### 💡 1. 模型假设

我们希望用两个特征预测价格：

$$
\hat{y} = w_1 x_1 + w_2 x_2 + b
$$

其中：

- $x_1$：面积
- $x_2$：楼层
- $w_1, w_2$：权重（系数）
- $b$：偏置（截距）

我们的目标是找到这三个参数，使得模型的预测值 $\hat{y}$ 尽可能接近真实值 $y$。

---

### 🎯 2. 损失函数

同样采用**最小二乘法**：

$$
L(w_1, w_2, b) = \sum_{i=1}^{n} \left( y_i - (w_1 x_1^{(i)} + w_2 x_2^{(i)} + b) \right)^2
$$

我们希望对 $w_1, w_2, b$ 进行优化，使损失函数最小。

---

### ✏️ 3. 使用偏导求解

我们对每个变量分别求偏导并令其为 0，得到三元一次方程组。

#### 对 $w_1$ 求偏导：

$$
\frac{\partial L}{\partial w_1} = -2 \sum x_1^{(i)} \left( y_i - (w_1 x_1^{(i)} + w_2 x_2^{(i)} + b) \right) = 0 
$$

#### 对 $w_2$ 求偏导：

$$
\frac{\partial L}{\partial w_2} = -2 \sum x_2^{(i)} \left( y_i - (w_1 x_1^{(i)} + w_2 x_2^{(i)} + b) \right) = 0 
$$

#### 对 $b$ 求偏导：

$$
\frac{\partial L}{\partial b} = -2 \sum \left( y_i - (w_1 x_1^{(i)} + w_2 x_2^{(i)} + b) \right) = 0 
$$

---

### 🧮 4. 整理为线性方程组

我们现在有三条线性方程，未知量是 $w_1, w_2, b$。将它们写成如下形式：

$$
\begin{cases}
\sum x_1 y = w_1 \sum x_1^2 + w_2 \sum x_1 x_2 + b \sum x_1 \\
\sum x_2 y = w_1 \sum x_1 x_2 + w_2 \sum x_2^2 + b \sum x_2 \\
\sum y = w_1 \sum x_1 + w_2 \sum x_2 + nb \\
\end{cases}
$$

这是一个**三元一次线性方程组**，可以解出最优参数 $w_1, w_2, b$。

> ✅ 在实际代码中，我们推荐直接写成矩阵形式（更通用），如下：

---

### 🧾 5. 矩阵形式（1 分钟）

构建特征矩阵 $\mathbf{X}$ 和标签向量 $\mathbf{y}$：

$$
\mathbf{X} =
\begin{bmatrix}
x_1^{(1)} & x_2^{(1)} & 1 \\
x_1^{(2)} & x_2^{(2)} & 1 \\
\vdots & \vdots & \vdots \\
x_1^{(n)} & x_2^{(n)} & 1
\end{bmatrix},
\quad
\mathbf{y} =
\begin{bmatrix}
y^{(1)} \\
y^{(2)} \\
\vdots \\
y^{(n)}
\end{bmatrix}
$$

---

目标：

$$
\min_{\boldsymbol{w}} \| \mathbf{y} - \mathbf{X} \boldsymbol{w} \|^2
$$

正规方程解为：

$$
\boldsymbol{w} =
\begin{bmatrix}
w_1 \\
w_2 \\
b
\end{bmatrix}
=
(\mathbf{X}^T \mathbf{X})^{-1} \mathbf{X}^T \mathbf{y}
$$

---

### 📈 6. 图示讲解

在 3D 空间中：

- 横轴是 $x_1$（面积）
- 纵轴是 $x_2$（楼层）
- 纵向是 $y$（房价）

我们不是拟合一条线，而是拟合一个**平面**，这个平面最小化所有点到平面的垂直距离平方和。

![bg right:40% 90%](https://s.ar8.top/img/picgo/20250423175529271.webp)

---

## 🎓 四. 多元线性回归

### 🧩 1、多元线性模型

随着特征数量增加（面积、楼层、房龄、卧室数、车位数……），我们的模型需要从二维平面扩展到**高维空间**。

$$
\hat{y}^{(i)} = w_1 x_1^{(i)} + w_2 x_2^{(i)} + \cdots + w_d x_d^{(i)} + b
$$

记作：

$$
\hat{y}^{(i)} = \mathbf{x}^{(i)T} \mathbf{w} + b
$$

---

### 🧾 2、矩阵形式定义

为了统一表示，我们把偏置项 $b$ 合并到参数里，定义“扩展特征向量”：

- 扩展输入向量：$\quad \tilde{\mathbf{x}}^{(i)} = [x_1^{(i)}, x_2^{(i)}, \dots, x_d^{(i)}, 1]^T$
- 扩展参数向量：$\quad \tilde{\mathbf{w}} = [w_1, w_2, \dots, w_d, b]^T$

设：

- $\mathbf{X}$：$n \times (d+1)$ 输入特征矩阵  
  每一行是一个样本，每一列是一个特征（加 1 列全 1 用于偏置）

- $\mathbf{y}$：$n \times 1$ 实际输出列向量  
- $\boldsymbol{w}$：$(d+1) \times 1$ 参数向量（包含偏置）

我们的目标是学习：

$$
\hat{\mathbf{y}} = \mathbf{X} \boldsymbol{w}
$$

---

### 🎯 3、损失函数定义

采用 **最小二乘法（MSE）**：

$$
L(\boldsymbol{w}) = \|\mathbf{y} - \mathbf{X} \boldsymbol{w} \|^2 = (\mathbf{y} - \mathbf{X} \boldsymbol{w})^T (\mathbf{y} - \mathbf{X} \boldsymbol{w})
$$

---

### ✏️ 4、正规方程推导

对 $\boldsymbol{w}$ 求导：

$$
\nabla_{\boldsymbol{w}} L = -2 \mathbf{X}^T (\mathbf{y} - \mathbf{X} \boldsymbol{w})
$$

令导数为 0（最小点）：

$$
\mathbf{X}^T \mathbf{y} = \mathbf{X}^T \mathbf{X} \boldsymbol{w}
$$

整理得：

$$
\boldsymbol{w} = (\mathbf{X}^T \mathbf{X})^{-1} \mathbf{X}^T \mathbf{y}
$$

这就是线性回归的解析解 —— **正规方程（Normal Equation）**

---

## 五. 使用 NumPy 实现正规方程求解多元线性回归参数
好的！我们现在来使用 **NumPy + Matplotlib** 实现一份完整的 **多元线性回归（矩阵求解）** 并配套图示的代码示例。

### 📊 模拟数据（房价预测）

特征：
- 面积 $x_1$
- 楼层 $x_2$

标签：
- 房价 $y$

---

### ✅ 完整代码

外部参考

---

### 🧾 输出结果示例

```
回归权重 w1（面积）: 4.705882352941173
回归权重 w2（楼层）: 1.1764705882352907
偏置项 b: 21.17647058823536
```

### 拟合平面含义：
$$
\hat{y} = 4.71 \cdot x_1 + 1.18 \cdot x_2 + 21.18
$$

即：
- 每多 1 平方米 → 房价增加 4.7 万元
- 每高 1 楼层 → 房价增加 1.18 万元
- 理论“基准价格”是 21.18 万元（当面积 = 0 且楼层 = 0）

---

### 拟合图像

![拟合图像](https://s.ar8.top/img/picgo/20250423183034079.webp)

---

### 🎯 问题示例：多因素房价预测

我们用下面 4 个特征来预测房价：

| 面积（㎡） $x_1$ | 楼层 $x_2$ | 房龄（年） $x_3$ | 卧室数 $x_4$ | 房价 $y$（万元） |
|-------------------|-------------|------------------|---------------|-------------------|
| 50                | 3           | 20               | 2             | 210               |
| 65                | 2           | 15               | 3             | 265               |
| 80                | 5           | 10               | 4             | 325               |
| 55                | 4           |  7               | 2             | 255               |
| 90                | 1           |  3               | 5             | 480               |

---

## ✅ 实现代码（NumPy 求解 4 元回归）

外部参考

---

### 🧾 示例输出（可能略有浮动）

```
面积 的权重: -16.8167
楼层 的权重: 1.2500
房龄 的权重: -9.8333
卧室数 的权重: 259.3333
偏置 的权重: 725.0833

预测价格（75㎡, 3楼, 8年, 3室）: 166.92 万元
```

> 🔍 说明：面积每增加 1㎡，房价增加 4 万元，房龄每多 1 年减少 2.5 万元，楼层与卧室数也有正相关。

---

## ✅ 小结

- 什么是线性回归
- 一元线性回归
- 二元线性回归
- 多元线性回归
- 使用numpy实现正规方程求解多元线性回归参数

---

**下一节预告：**
> 🔍 开始学习使用梯度下降的方式来解决线性回归问题